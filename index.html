<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Statechart Editor</title>
  <link rel="shortcut icon" href="./favicon.ico">
</head>
<body id="body">

<!-- <canvas id="palette" style="position:fixed"></canvas> -->
<canvas id="canvas" style="position:relative"></canvas>

<script src="JSAppFramework/base.js"></script>
<script src="JSAppFramework/collections.js"></script>
<script src="JSAppFramework/data_models.js"></script>
<script src="JSAppFramework/diagrams.js"></script>
<script src="JSAppFramework/geometry.js"></script>
<script src="statecharts.js"></script>
<script src="third_party/FileSaver.min.js"></script>
<script src="third_party/canvas2svg/canvas2svg.js"></script>

<script type="text/javascript" language="JavaScript">
'use strict';
(function() {

  const body = document.getElementById('body'),
        canvas = document.getElementById('canvas'),
        // palette = document.getElementById('palette'),
        // TODO proper "document" handling.
        statechartModel = { root: statechart_data },
        theme = diagrams.theme.createDefault(),  // or createBlueprint
        panZoomLayer = new diagrams.CanvasPanZoomLayer(false),
        canvasController = new diagrams.CanvasController(canvas, theme),
        // paletteController = new diagrams.CanvasController(palette, theme),
        propertyGridController = new diagrams.PropertyGridController(body, theme),
        statechartEditor = new statecharts.Editor(
            statechartModel, theme, canvasController, propertyGridController);

  document.bgColor = theme.bgColor;

  canvasController.configure([panZoomLayer, statechartEditor]);
  canvasController.setSize(window.innerWidth, window.innerHeight);
  // paletteController.configure([statechartEditor]);
  // paletteController.setSize(150, 100);

  window.onbeforeunload = function() {
    return "Are you sure you want to navigate away?";
  }

  function onPointerDown(e) {
    e.preventDefault();
    canvasController.onPointerDown(e);
  }

  function onPointerMove(e) {
    e.preventDefault();
    canvasController.onPointerMove(e);
  }

  function onPointerUp(e) {
    e.preventDefault();
    canvasController.onPointerUp(e);
  }

  function onDoubleClick(e) {
    canvasController.onDoubleClick(e);
  }

  canvas.addEventListener('pointerdown', onPointerDown);
  canvas.addEventListener('pointermove', onPointerMove);
  canvas.addEventListener('pointerup', onPointerUp);

  canvas.addEventListener('dblclick', onDoubleClick);

  document.addEventListener('keydown', function(e) {
    // Handle any keyboard commands for the app window here.
    canvasController.onKeyDown(e);
  });

  document.addEventListener('keyup', function(e) {
    canvasController.onKeyUp(e);
  });
})();

</script>

</body>
</html>