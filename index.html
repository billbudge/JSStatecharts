<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sandbox</title>
  <link rel="shortcut icon" href="./favicon.ico">
</head>
<body id="body">

<canvas id="test_canvas" style="position:relative"></canvas>

<script src="JSAppFramework/base.js"></script>
<script src="JSAppFramework/collections.js"></script>
<script src="JSAppFramework/data_models.js"></script>
<script src="JSAppFramework/diagrams.js"></script>
<script src="JSAppFramework/geometry.js"></script>
<script src="statecharts.js"></script>
<script src="third_party/FileSaver.min.js"></script>
<script src="third_party/canvas2svg/canvas2svg.js"></script>

<script type="text/javascript" language="JavaScript">
'use strict';

// TODO remove these dangerous globals.
let body = document.getElementById('body'),
    canvas = document.getElementById('test_canvas');
let ctx = canvas.getContext('2d');

const statechartModel = { root: statechart_data },
      theme = diagrams.theme.createDefault(),  // or createBlueprint
      canvasController = new diagrams.CanvasController(canvas, ctx, theme),
      propertyGridController = new diagrams.PropertyGridController(body, theme);

document.bgColor = theme.bgColor;

const statechartEditor = new statecharts.Editor(statechartModel, theme, propertyGridController),
      panZoomLayer = new diagrams.CanvasPanZoomLayer();

canvasController.configure([panZoomLayer, statechartEditor]);

function resizeCanvas() {
  canvasController.resize(window.innerWidth, window.innerHeight);
}

resizeCanvas();

window.onresize = resizeCanvas;

window.onbeforeunload = function() {
  return "Are you sure you want to navigate away?";
}

function onMouseDown(e) {
  e.preventDefault();
  canvasController.onMouseDown(e);
}

function onMouseMove(e) {
  e.preventDefault();
  canvasController.onMouseMove(e);
}

function onMouseUp(e) {
  e.preventDefault();
  canvasController.onMouseUp(e);
}

function onDoubleClick(e) {
  canvasController.onDoubleClick(e);
}

canvas.addEventListener('mousedown', onMouseDown);
canvas.addEventListener('mousemove', onMouseMove);
canvas.addEventListener('mouseup', onMouseUp);

canvas.addEventListener("touchstart", onMouseDown);
canvas.addEventListener("touchend", onMouseUp);
// canvas.addEventListener("touchcancel", handleCancel, false);
// canvas.addEventListener("touchleave", handleEnd, false);
canvas.addEventListener("touchmove", onMouseMove);

canvas.addEventListener('dblclick', onDoubleClick);

document.addEventListener('keydown', function(e) {
  // Handle any keyboard commands for the app window here.
  canvasController.onKeyDown(e);
});

document.addEventListener('keyup', function(e) {
  canvasController.onKeyUp(e);
});

</script>

</body>
</html>